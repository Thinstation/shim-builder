# Maintainer : Daniel Bermond < gmail-com: danielbermond >
# Contributor: Taylor Smock <vorpalblade77@gmail.com>
# Contributor: Keshav Amburay <the.ridikulus.rat@gmail.com>

name=shim
version=15.8
release=3
source=(UEFI-CA.cer \
	BOOTX64.csv \
	https://github.com/rhboot/shim/releases/download/$version/shim-$version.tar.bz2 \
	)

build() {
    unset CFLAGS CXXFLAGS

    cd shim-$version

    cat $SRC/BOOTX64.csv >> data/sbat.csv
    VENDOR="`cat $SRC/BOOTX64.csv |awk -F ',' '{print $3}'`"

    export VENDOR_CERT_FILE="$SRC/UEFI-CA.cer"
    export ENABLE_HTTPBOOT='1'
    export DEFAULT_LOADER='grubx64.efi'
    export SOURCE_DATE_EPOCH=foo


    make

    make EFIDIR=$VENDOR DESTDIR="$PKG" install
    make DESTDIR="$PKG" install-as-data

    install -D -m644 COPYRIGHT "${PKG}/usr/share/licenses/${name}/LICENSE"

    rm -rf $PKG/usr/{src,lib/debug}
}
