# Description: Shadow password file utilities
# URL: https://github.com/shadow-maint/shadow/
# Maintainer: CRUX System Team, core-ports at crux dot nu
# Depends on: acl linux-pam

name=shadow
version=4.14.5
release=2
source=(https://github.com/shadow-maint/$name/releases/download/$version/$name-$version.tar.xz \
	pwck chfn chsh login groupadd groupdel \
	groupmems groupmod passwd su useradd userdel usermod)

build() {
	cd $name-$version

	./configure \
		--prefix=/usr \
		--bindir=/usr/bin \
		--sbindir=/usr/sbin \
		--sysconfdir=/etc \
		--disable-shared

	make
	make DESTDIR=$PKG install
	make -C man DESTDIR=$PKG install

	install -d $PKG/{bin,sbin}
	mv $PKG/usr/bin/login $PKG/bin
	mv $PKG/usr/sbin/nologin $PKG/sbin
	chmod -s $PKG/usr/sbin/*

	install -d $PKG/etc/cron/daily $PKG/var/log
	install -m 644 etc/login.defs $PKG/etc
	install -m 755 $SRC/pwck $PKG/etc/cron/daily
	touch $PKG/var/log/{lastlog,faillog}

	rm -r $PKG/usr/bin/gpasswd \
		$PKG/usr/sbin/{chpasswd,logoutd} \
		$PKG/usr/sbin/newusers \
		$PKG/usr/share/man/man1/gpasswd.1 \
		$PKG/usr/share/man/man8/{chpasswd.8,logoutd.8} \
		$PKG/usr/share/man/man8/newusers.8 \
		$PKG/usr/share/man/man5/gshadow.5 \
		$PKG/usr/share/man/man3

	install -o root -g root -m 0644 \
		$SRC/{ch{fn,sh},login,group{add,del,mems,mod},passwd,su,user{add,del,mod}} \
		$PKG/etc/pam.d/
}
